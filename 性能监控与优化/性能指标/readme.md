# 性能监控
## 几个典型指标
* 首次绘制（FP）和首次有内容绘制（FCP）时间
* 首次有意义绘制（FMP）时间
* 首屏时间
* 用户可交互（TTI）时间
* 总下载时间
* 自定义指标

下面是这些指标的含义：

> 首次绘制（FP）时间：对于应用页面，用户在视觉上首次出现不同于跳转之前的内容时间点，或者说是页面发生第一次绘制的时间点。

> 首次有内容绘制（FCP）时间：指浏览器完成渲染 DOM 中第一个内容的时间点，可能是文本、图像或者其他任何元素，此时用户应该在视觉上有直观的感受。

> 首次有意义绘制（FMP）时间：指页面关键元素渲染时间。这个概念并没有标准化定义，因为关键元素可以由开发者自行定义——究竟什么是“有意义”的内容，只有开发者或者产品经理自己了解。推荐参考FMP智能获取算法：[fmp-timing](https://github.com/qbright/fmp-timing)

> 首屏时间：对于所有网页应用，这是一个非常重要的指标。用大白话来说，就是进入页面之后，> 应用渲染完整个手机屏幕（未滚动之前）内容的时间。需要注意的是，业界对于这个指标其实同样并没有确切的定论，比如这个时间是否包含手机屏幕内图片的渲染完成时间。　

> 用户可交互时间：顾名思义，也就是用户可以与应用进行交互的时间。一般来讲，我们认为是 domready 的时间，因为我们通常会在这时候绑定事件操作。如果页面中涉及交互的脚本没有下载完成，那么当然没有到达所谓的用户可交互时间。那么如何定义 domready 时间呢？我推荐参考司徒正美的文章：何谓 domReady。

## 文档加载时序图
![时序图](https://camo.githubusercontent.com/ce24986de437081e9d2b4979b3146fa2100d0312/687474703a2f2f696d672e696d7a71672e746f702f31353432363830383635383738372e706e67)

## 性能数据获取
利用performance API timing对象的属性，根据文档加载的时序图两辆相差来获取相应的时间段。
![performance timing](https://images.gitbook.cn/ba109250-b8f4-11e9-953b-67880772eeef)

参考：[calcTimes](https://github.com/LaoLeo/webCoreKnowledge/blob/master/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87/performance.js)

## 计算首屏时间
* 手动埋点：在接近首屏底部的元素位置手动埋点统计，入侵性强且不好维护。
* [集中化脚本统计方法](https://github.com/LaoLeo/webCoreKnowledge/blob/master/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87/firstScreenTime.js)（统计首屏内耗费资源标签（如img）的加载情况，当作首屏时间）
    - 利用定时器检测
    - 在耗费资源标签上绑定回调函数
